# alx-files_manager
A project to summarize the backend specialization training with ALX. The objective is to build a simple platform to upload and view files (users authenticate via a token, users can list all files, users can upload a new file, change the permission of a file, view the file and generate thumbnails for images).


## Setup environment

- node v12.x.x
- Ubuntu 18.04

## Tasks

- `utils.redis.js` file contains the `RedisClient` which is a class that  create a client to Redis such that any error of the redis client must be displayed in the console. There is a method `isAlive` that returns true when the connection to Redis is a success otherwise false. There are some asynchronous methods `get`, `set` and `del` that returns the Redis value for a stored key, set a key value pair with an expiration duration and deletes a Redis key.

```python
# Usage
import redisClient from './utils/redis';

(async () => {
    console.log(redisClient.isAlive());
    console.log(await redisClient.get('myKey'));
    await redisClient.set('myKey', 12, 5);
    console.log(await redisClient.get('myKey'));

    setTimeout(async () => {
        console.log(await redisClient.get('myKey'));
    }, 1000*10)
})();
```
```bash
bob@dylan:~$ npm run dev main.js
true
null
12
null
```
- `utils/db.js` file contains the class `DBClient` -- a class that creates a client to MongoDB that retrieves the host, port and database from the environment variables `DB_HOST`, `DB_PORT`, and `DB_DATABASE`. The class has the method `isAlive` which does the same function as that of `RedisClient`, two asynchronous methods `nbUsers` and `nbFiles` to return the number of documents in the collection of `users` and `files` respectively.

```python
# Usage
import dbClient from './utils/db';

const waitConnection = () => {
    return new Promise((resolve, reject) => {
        let i = 0;
        const repeatFct = async () => {
            await setTimeout(() => {
                i += 1;
                if (i >= 10) {
                    reject()
                }
                else if(!dbClient.isAlive()) {
                    repeatFct()
                }
                else {
                    resolve()
                }
            }, 1000);
        };
        repeatFct();
    })
};

(async () => {
    console.log(dbClient.isAlive());
    await waitConnection();
    console.log(dbClient.isAlive());
    console.log(await dbClient.nbUsers());
    console.log(await dbClient.nbFiles());
})();
```
```bash
bob@dylan:~$ npm run dev main.js
false
true
4
30
```
- `server.js` creates an express server that listens on port 5000 if port is not set by the environment variable `PORT` and loads all routes from the file `routes/index.js`. The `routes/index.js` contains all endpoints of the API which are `GET /status` and `GET /stats` handled by `AppController.getStatus` and `AppController.getStats` respectively. The AppController class is contained within `controllers.AppController.js`. `GET /status` should return if Redis is alive and if the DB is alive too by using the 2 utils.
```bash
# Usage
# Terminal 1:
bob@dylan:~$ npm run start-server
Server running on port 5000
...
# Terminal 2:
bob@dylan:~$ curl 0.0.0.0:5000/status ; echo ""
{"redis":true,"db":true}
bob@dylan:~$ 
bob@dylan:~$ curl 0.0.0.0:5000/stats ; echo ""
{"users":4,"files":30}
bob@dylan:~$ 
```
- add a new endpoin to the `routes/index.js` file which is `POST /users` that will be handled by `UserControllers.postNew` inside `controllers/UsersController.js`. A new user is created with an email and password where missing email or password is handled with the appropriate status code and message. Already existing email should return an error too. The new user's password should be hased in `SHA1` and if successfully created return the object containing the email and id (autogenerated by MongoDB) with status 201.
```bash
# Usage
# Terminal 2:
bob@dylan:~$ curl 0.0.0.0:5000/users -XPOST -H "Content-Type: application/json" -d '{ "email": "bob@dylan.com", "password": "toto1234!" }' ; echo ""
{"id":"5f1e7d35c7ba06511e683b21","email":"bob@dylan.com"}
bob@dylan:~$ 
bob@dylan:~$ echo 'db.users.find()' | mongo files_manager
{ "_id" : ObjectId("5f1e7d35c7ba06511e683b21"), "email" : "bob@dylan.com", "password" : "89cad29e3ebc1035b29b1478a8e70854f25fa2b2" }
bob@dylan:~$ 
bob@dylan:~$ 
bob@dylan:~$ curl 0.0.0.0:5000/users -XPOST -H "Content-Type: application/json" -d '{ "email": "bob@dylan.com", "password": "toto1234!" }' ; echo ""
{"error":"Already exist"}
bob@dylan:~$ 
bob@dylan:~$ curl 0.0.0.0:5000/users -XPOST -H "Content-Type: application/json" -d '{ "email": "bob@dylan.com" }' ; echo ""
{"error":"Missing password"}
bob@dylan:~$ 
```
-
